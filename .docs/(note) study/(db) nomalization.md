# 데이터베이스 정규화(Normalization) 정리

## 1. 정규화는 왜 필요한가?
데이터베이스 정규화는 테이블 구조를 체계적으로 정리하는 과정입니다. 핵심 목표는 두 가지입니다.
- **데이터 중복 방지**: 똑같은 정보가 여러 곳에 저장되는 것을 막아 저장 공간을 효율적으로 사용합니다.
- **이상 현상(Anomaly) 방지**: 데이터를 추가, 수정, 삭제할 때 발생할 수 있는 논리적 오류를 막습니다.

## 2. 이상 현상(Anomaly)이란?
잘못 설계된 데이터베이스에서 데이터를 조작할 때 발생하는 예기치 못한 문제점들을 말합니다.

- 🔹 **수정 이상 (Update Anomaly)**
  - **문제**: 반복된 데이터 중 일부만 수정되어 데이터가 불일치하게 되는 현상입니다.
  - **예시**: '대전'에 사는 A씨가 '도쿄'로 이사해서 주소를 변경할 때, A씨의 데이터가 여러 개 있다면 그중 하나라도 빠뜨릴 경우 A씨는 '대전'과 '도쿄'에 동시에 사는 이상한 상태가 됩니다.

- 🔹 **삽입 이상 (Insertion Anomaly)**
  - **문제**: 어떤 데이터를 추가하려면 불필요한 다른 데이터가 꼭 있어야만 하는 현상입니다.
  - **예시**: '상품'이 있어야만 '카테고리'를 등록할 수 있는 테이블 구조라면, 아직 상품이 없는 새로운 카테고리는 아예 추가할 수 없습니다.

- 🔹 **삭제 이상 (Deletion Anomaly)**
  - **문제**: 어떤 데이터를 삭제했을 때, 유지되어야 할 다른 정보까지 함께 사라지는 현상입니다.
  - **예시**: 특정 상품 하나를 삭제했더니, 그 상품이 속해 있던 '카테고리' 정보 자체가 데이터베이스에서 사라져 버릴 수 있습니다.

## 3. 정규화를 위한 핵심 개념
- 🔑 **키 (Key)**
  - 테이블의 수많은 데이터 중에서 특정 한 줄을 유일하게 식별할 수 있는 값입니다.
  - **기본 키 (Primary Key, PK)**: 후보 키 중에서 대표로 선정된 키.
    - **규칙 1**: 반드시 고유한 값이어야 합니다 (Unique).
    - **규칙 2**: 절대 비어 있을 수 없습니다 (Not Null).
    - **예시**: 주민등록번호, 학번
  - **후보 키 (Candidate Key)**: 기본 키가 될 수 있는 자격을 가진 모든 키.
  - **외래 키 (Foreign Key, FK)**: 다른 테이블의 기본 키를 참조하여 테이블과 테이블을 연결하는 다리 역할을 하는 키.

- 🔗 **함수 종속성 (Functional Dependency)**
  - 어떤 값(X)을 알면, 다른 값(Y)을 무조건 하나로 결정할 수 있는 관계를 말하며, `X → Y` 로 표기합니다.
  - **성립 O**: 주민등록번호 → 이름 (주민등록번호를 알면 이름은 하나로 정해집니다.)
  - **성립 X**: 이름 → 주민등록번호 (동명이인이 있을 수 있으므로 이름만으로는 특정할 수 없습니다.)

## 4. 정규화 단계
- ✅ **제1정규형 (1NF): 원자성 확보**
  - "모든 열은 반드시 원자적인(Atomic) 값만 가져야 한다." 즉, 한 칸에 여러 개의 값이 들어갈 수 없다는 규칙입니다.
  - **문제 상황**
    | 학번 | 이름 | 취미 |
    | :-- | :-- | :-- |
    | 1001 | A | 게임, 영화 |
    | 1002 | B | 게임, 노래 |
  - **1NF 적용 후**
    | 학번 | 이름 | 취미 |
    | :-- | :-- | :-- |
    | 1001 | A | 게임 |
    | 1001 | A | 영화 |
    | 1002 | B | 게임 |
    | 1002 | B | 노래 |

- ✅ **제2정규형 (2NF): 부분 함수 종속 제거**
  - "1NF를 만족하고, 기본 키의 일부가 아닌 전체에 모든 열이 종속되어야 한다." (기본 키가 복합 키일 때 의미가 있습니다.)
  - **문제 상황** (기본 키: `학번`, `취미코드`)
    | 학번 | 취미코드 | 이름 | 취미 | 실력 |
    | :-- | :-- | :-- | :-- | :-- |
    | 1001 | a01 | A | 게임 | 상 |
    | 1002 | a01 | B | 게임 | 중 |
  - 종속 관계: `학번 → 이름`, `취미코드 → 취미` 와 같이 기본 키의 일부에만 종속된 관계(부분 함수 종속)를 제거해야 합니다.
  - **2NF 적용 후**: 부분 종속 관계에 있는 테이블들을 각각 분리합니다.
    - `[학생 테이블]`, `[취미 테이블]`, `[실력 테이블]`

- ✅ **제3정규형 (3NF): 이행적 함수 종속 제거**
  - "2NF를 만족하고, 기본 키가 아닌 다른 일반 열에 종속되는 열이 없어야 한다."
  - **문제 상황** (기본 키: `회원 ID`)
    | 회원 ID | 등급 | 할인율 |
    | :-- | :-- | :-- |
    | user01 | VIP | 15% |
    | user02 | Gold | 10% |
  - 종속 관계: `회원 ID → 등급 → 할인율` 처럼 꼬리를 무는 종속 관계(이행적 함수 종속)를 제거해야 합니다.
  - **3NF 적용 후**: 이행적 종속 관계에 있는 테이블을 분리합니다.
    - `[회원 테이블]`, `[등급 테이블]`

## 5. 중간 테이블 (Junction Table)을 두는 이유
다대다(Many-to-Many) 관계를 해소하기 위해 사용합니다.

### 다대다(N:M) 관계란?
- 학생 한 명은 여러 과목을 수강할 수 있다 (1:N)
- 과목 하나는 여러 학생이 수강할 수 있다 (1:N)

### 문제점
- 이 관계를 하나의 테이블로 표현하면 1NF를 위반하거나, 불필요한 데이터 중복이 발생하여 키를 특정하기 어렵고 이상 현상이 발생합니다.

### 해결책: 중간 테이블
1.  각각의 정보를 담은 독립적인 테이블을 만듭니다. (`학생 테이블`, `과목 테이블`)
2.  두 테이블의 기본 키(ID)만 가져와 서로 연결해주는 중간 테이블을 만듭니다.

이렇게 하면 데이터 중복을 없애고 각 데이터의 고유성을 지키면서 관계를 깔끔하게 표현할 수 있습니다.